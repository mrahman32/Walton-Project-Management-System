@model IEnumerable<ProjectManagement.Models.MkProjectSpecModel>
    @{
        ViewBag.Title = "AllModelList";
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <div class="portlet light">
        <div class="portlet-title">
            <div class="caption">Models</div>
            <div class="actions">
                <input type="button" value="Create" class="btn btn-circle blue-madison btn-outline sbold uppercase" onclick="location.href = '@Url.Action("Spec", "Marketing")'" />
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-md-4">
                <div class="col-lg-4" style="text-align: left">
                    Brand
                </div>
                <div class="col-lg-8" style="text-align: left">
                    <div class="Brand-filter">
                        @Html.DropDownList("Brand", new SelectList(ViewBag.Brands, "", "Brand"), new { @class = "form-control chosenselect", @multiple = "multiple", @id = "categoryFilter" })
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="col-lg-4" style="text-align: left">
                    CP
                </div>
                <div class="col-lg-8" style="text-align: left">
                    <div class="col-lg-5" style="text-align: left">
                        <input type="number" class="form-control text-center" id="price1stPart" placeholder="min" />
                    </div>
                    <div class="col-lg-2"><span style="font-weight: 900">-</span></div>
                    <div class="col-lg-5" style="text-align: left">
                        <input type="number" class="form-control text-center" id="price2ndPart" placeholder="max" />
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
            <div class="col-lg-2" style="text-align: left">
                RAM
            </div>
            <div class="col-lg-10" style="text-align: left">
                <div class="col-lg-3" style="text-align: left">
                    <input type="number" class="form-control text-center" id="ram1stPart" placeholder="min" />
                </div>
                <div class="col-lg-1"><span style="font-weight: 600">-</span></div>
                <div class="col-lg-3" style="text-align: left">
                    <input type="number" class="form-control text-center" id="ram2ndPart" placeholder="max" />
                </div>
                <div class="col-md-3">
                    <div class="RamBand-filter">
                        <select id="RamBandFilter" class="form-control ddChosen">
                            <option value="">All</option>
                            <option value="GB">GB</option>
                            <option value="MB">MB</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <br />
        <div class="row">
            <div class="col-md-4">
                <div class="col-lg-4" style="text-align: left">
                    PLC
                </div>
                <div class="col-lg-8" style="text-align: left">
                    <div class="PLC-filter">
                        <select id="PLCFilter" class="form-control chosenselect" multiple >
                            @*<option value="">Show All</option>*@
                            <option value="EOL">EOL</option>
                            <option value="EOL-R">EOL-R</option>
                            <option value="MP">MP</option>
                            <option value="NP">NP</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4">Display Size<span class="font-sm">(inch)</span></label>
                    <div class="col-md-8">
                        <div class="col-md-5">
                            <input type="number" class="form-control text-center" id="displaySize1stPart" placeholder="min" />
                        </div>
                        <div class="col-md-2"><span style="font-weight: 900">-</span></div>
                        <div class="col-md-5">
                            <input type="number" class="form-control text-center" id="displaySize2ndPart" placeholder="max" />
                        </div>
                    </div>
                </div>
            </div>            
            <div class="col-md-4">
                <div class="form-group">
                    <div class="col-lg-2" style="text-align: left">
                        ROM
                    </div>
                    <div class="col-md-10">
                        <div class="col-md-3" style="text-align: left">
                            <input type="number" class="form-control text-center" id="rom1stPart" placeholder="min" />
                        </div>
                        <div class="col-md-1"><span style="font-weight: 600">-</span></div>
                        <div class="col-md-3">
                            <input type="number" class="form-control text-center" id="rom2ndPart" placeholder="max" />
                        </div>
                        <div class="col-md-3">
                            <div class="RomBand-filter">
                                <select id="RomBandFilter" class="form-control ddChosen">
                                    <option value="">All</option>
                                    <option value="GB">GB</option>
                                    <option value="MB">MB</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        <br />
        <div class="row">
            <div class="col-md-4">
                <div class="col-lg-4" style="text-align: left">
                    Product.Type
                </div>
                <div class="col-lg-8" style="text-align: left">
                    <div class="PType-filter">
                        <select id="PTypeFilter" class="form-control ddChosen">
                            <option value="">Show All</option>
                            <option value="Smart">Smart</option>
                            <option value="Feature">Feature</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="form-group">
                    <div class="col-lg-4" style="text-align: left">
                        Battery(mAh)
                    </div>
                    <div class="col-md-8">
                        <div class="col-md-5">
                            <input type="number" class="form-control text-center" id="battery1stPart" placeholder="min" />
                        </div>
                        <div class="col-md-2"><span style="font-weight: 900">-</span></div>
                        <div class="col-md-5">
                            <input type="number" class="form-control text-center" id="battery2ndPart" placeholder="max" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="portlet-body">
            <div class="row">
                <div class="col-md-12">
                    <div class="table-scrollable">                        
                        <table id="tblSpecs" class="table table-bordered">
                            <thead>
                                <tr>

                                    <th class="">Id</th>
                                    <th class="text-center bold" id="PType">Product Type</th>
                                    <th class="text-center bold" id="Brand">Brand</th>
                                    <th class="text-center bold">Model</th>
                                    <th class="text-center bold" id="PLC">PLC</th>
                                    <th class="text-center bold">Network</th>
                                    <th class="text-center bold">Display Size</th>
                                    <th class="text-center bold">Display Type</th>
                                    <th class="text-center bold">OS</th>
                                    <th class="text-center bold">Os Version</th>
                                    <th class="text-center bold">Resolation</th>
                                    <th class="text-center bold">Refresh Rate</th>
                                    <th class="text-center bold">Chipset</th>
                                    <th class="text-center bold">CPU</th>
                                    <th class="text-center bold">CPU Frequency</th>
                                    <th class="text-center bold">Front Camera</th>
                                    <th class="text-center bold">Back Camera</th>
                                    <th class="text-center bold" id="Ram">RAM</th>
                                    <th class="text-center bold" id="Rom">ROM</th>
                                    <th class="text-center bold">BatteryCapacity</th>
                                    <th class="text-center bold">FP Sensor</th>
                                    <th class="text-center bold">Face ID</th>
                                    <th class="text-center bold">Dimensions</th>
                                    <th class="text-center bold">DP</th>
                                    <th class="text-center bold">RP</th>
                                    <th class="text-center bold">CP</th>
                                    <th class="text-center bold">FOB (USD)</th>
                                    <th class="text-center bold">Release Date</th>
                                    <th class="text-center bold">Added By</th>
                                    <th class="text-center bold">NOC Date</th>
                                    <th class="text-center bold">NOC Total Qty(Thousand)</th>
                                    <th class="text-center bold">NOC Last Qty(Thousand)</th>
                                    @if (User.IsInRole("CM") || User.IsInRole("CMHEAD") || User.IsInRole("BI") || User.IsInRole("BIHEAD") || User.IsInRole("SA"))
                                    {
                                        <th class="text-center bold">Import_Price</th>
                                    }
                                    <th class="text-center bold">Action</th>

                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var m in Model)
                                {
                                    <tr>
                                        <td class="">@m.Id</td>
                                        <td class="text-center">@m.ProductType</td>
                                        <td class="text-center">@m.Brand</td>
                                        <td class="text-center">@m.ModelName</td>
                                        <td class="text-center">@m.PLC</td>
                                        <td class="text-center">@m.Network</td>
                                        <td class="text-center">@m.DisplaySize</td>
                                        <td class="text-center">@m.DisplayType</td>
                                        <td class="text-center"><span>(</span>@m.ResolutionHor<span>x</span>@m.ResolutionVer<span>) &nbsp;</span>@m.ResolutionName</td>
                                        <td class="text-center">@m.RefreshRate<span>&nbsp;Hz</span></td>
                                        <td class="text-center">@m.OperatingSystem</td>
                                        <td class="text-center">@m.OsVersion</td>
                                        <td class="text-center">@m.ChipsetBrand<span>-</span>@m.ChipsetModel</td>
                                        <td class="text-center">@m.CPU</td>
                                        <td class="text-center">@m.CPUFrequency<span>&nbsp;GHz</span></td>
                                        <td class="text-center">@m.FrontCamera<span>&nbsp;MP</span></td>
                                        <td class="text-center">@m.BackCamera<span>&nbsp;MP</span></td>
                                        <td class="text-center">@m.RAM<span>&nbsp;</span>@m.RAM_Band</td>
                                        <td class="text-center">@m.ROM<span>&nbsp;</span>@m.ROM_Band</td>
                                        <td class="text-center">@m.BatteryCapacity<span>&nbsp;mAh</span></td>
                                        <td class="text-center">@m.FPSensor</td>
                                        <td class="text-center">@m.FaceID</td>
                                        <td class="text-center">@m.DimensionsLength<span>x</span>@m.DimensionsWidth<span>x</span>@m.DimensionsThikness<span>&nbsp;mm</span></td>
                                        <td class="text-center">@m.InvoicePrice</td>
                                        <td class="text-center">@m.DealerPrice</td>
                                        <td class="text-center">@m.Price</td>
                                        <td class="text-center">@m.UpcomingPrice</td>
                                        <td class="text-center">
                                            @if (m.ReleaseDate != null)
                                                  {
                                                      @m.ReleaseDate.Value.ToShortDateString()
                                                  }
                                        </td>
                                        <td class="text-center">@m.AddedByName</td>
                                        @*<td class="text-center">@m.NOCDate.Value.ToShortDateString()</td>*@
                                        <td class="text-center">
                                            @if (m.NOCDate != null)
                                            {
                                                @m.NOCDate.Value.ToShortDateString()
                                            }
                                        </td>

                                        <td class="text-center">@m.NOCTotalQty<span>K</span></td>
                                        <td class="text-center">@m.NOCLastQty<span>K</span></td>
                                        @if (User.IsInRole("CM") || User.IsInRole("CMHEAD") || User.IsInRole("BI") || User.IsInRole("BIHEAD") || User.IsInRole("SA"))
                                        {
                                            <td class="text-center">@Html.TextBox("ImportPrice",@m.CommercialImportPrice, new { @class = "txtImportPrice form-control",type="number",Styles="width:50px;height:30px" })</td>
                                        }
                                        <td class="text-center">
                                            @if (User.IsInRole("MKT") || User.IsInRole("MKTHEAD") || User.IsInRole("PS") || User.IsInRole("BI") || User.IsInRole("BIHEAD") || User.IsInRole("SA"))
                                            {
                                                <input type="button" value="Edit" class="btn btn-circle btn-danger btnEdit" />
                                            }
                                            @if (User.IsInRole("CM") || User.IsInRole("CMHEAD") || User.IsInRole("BI") || User.IsInRole("BIHEAD") || User.IsInRole("SA"))
                                            {
                                                <input type="button" value="Save" class="btn btn-circle btn-danger btnPrice" />
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>

        $('.chosenselect').chosen({ width: '300px' });

        var table = $('#tblSpecs').DataTable({

            "scrollX": true,
            dom: 'lBfrtip',
            buttons: [
                'excel', 'print'
            ],
            columnDefs: [
                {
                    targets: [0],
                    "visible": false,
                    "searchable": false
                }
            ]
        });


        //$("#tblSpecs_filter.dataTables_filter").append($("#categoryFilter"));

        //Brand Filter
        var categoryIndex = 0;
        $("#tblSpecs th").each(function (i) {

            var test = $("#Brand").text().trim();//$($(this)).html();

            if (test == "Brand") {
                categoryIndex = 2; return false;
            }
        });

        $("#categoryFilter").change(function () {
            //assemble the regex expression for multiple select values
            var regEx = $(this).find(':selected').map(function () {
                return $(this).text();
            })
                .get()
                .join("|");
            table.column(categoryIndex).search(regEx, true, false).draw();
        });


        //PLC Filter
        var PLCIndex = 0;
        $("#tblSpecs th").each(function (i) {

            var test = $("#PLC").text().trim();//$($(this)).html();

            if (test == "PLC") {
                //debugger;
                PLCIndex = 4; return false;
            }
        });

        $("#PLCFilter").change(function () {
            //assemble the regex expression for multiple select values
            var regEx = $(this).find(':selected').map(function () {
                return $(this).text();
            })
                .get()
                .join("|");
            table.column(PLCIndex).search(regEx, true, false).draw();
        });


        //Product Type Filter
        var ProductTypeIndex = 0;
        $("#tblSpecs th").each(function (i) {
            //debugger;

            var test = $("#PType").text().trim();//$($(this)).html();

            if (test == "Product Type") {
                //debugger;
                ProductTypeIndex = 1; return false;
            }
        });
        //Use the built in datatables API to filter the existing rows by the Category column
        $.fn.dataTable.ext.search.push(
          function (settings, data, dataIndex) {
              var selectedItem = $('#PTypeFilter').val()
              var PType = data[ProductTypeIndex];
              //debugger;
              if (selectedItem === "" || PType.includes(selectedItem)) {
                  return true;
              }
              return false;
          }
        );
        //Set the change event for the Category Filter dropdown to redraw the datatable each time
        //a user selects a new filter.
        $("#PTypeFilter").change(function (e) {
            table.draw();
        });
        table.draw();

        //Display Size(inch) Range filter

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = $('#displaySize1stPart').val() * 1;
                var max = $('#displaySize2ndPart').val() * 1;
                //debugger;
                var age = parseFloat(data[6]) || 0; // use data for the age column

                if ((min == '' && max == '') ||
                     (min == '' && age <= max) ||
                     (min <= age && '' == max) ||
                     (min <= age && age <= max)) {
                    return true;
                }
                return false;
            }
        );

        //RAM Range filter

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = $('#ram1stPart').val() * 1;
                var max = $('#ram2ndPart').val() * 1;
                //debugger;
                var ram = parseFloat(data[17]) || 0; // use data for the age column

                if ((min == '' && max == '') ||
                     (min == '' && ram <= max) ||
                     (min <= ram && '' == max) ||
                     (min <= ram && ram <= max)) {
                    return true;
                }
                return false;
            }
        );

        //ROM Range filter

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = $('#rom1stPart').val() * 1;
                var max = $('#rom2ndPart').val() * 1;
                //debugger;
                var rom = parseFloat(data[18]) || 0; // use data for the age column

                if ((min == '' && max == '') ||
                     (min == '' && rom <= max) ||
                     (min <= rom && '' == max) ||
                     (min <= rom && rom <= max)) {
                    return true;
                }
                return false;
            }
        );

        //Battery Range filter

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = $('#battery1stPart').val() * 1;
                var max = $('#battery2ndPart').val() * 1;
                //debugger;
                var rom = parseFloat(data[19]) || 0; // use data for the age column

                if ((min == '' && max == '') ||
                     (min == '' && rom <= max) ||
                     (min <= rom && '' == max) ||
                     (min <= rom && rom <= max)) {
                    return true;
                }
                return false;
            }
        );

        //CP Range filter

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = $('#price1stPart').val() * 1;
                var max = $('#price2ndPart').val() * 1;
                //debugger;
                var rom = parseFloat(data[25]) || 0; // use data for the age column

                if ((min == '' && max == '') ||
                     (min == '' && rom <= max) ||
                     (min <= rom && '' == max) ||
                     (min <= rom && rom <= max)) {
                    return true;
                }
                return false;
            }
        );

        $(document).ready(function () {
            var table = $('#tblSpecs').DataTable();

            // Event listener to the two range filtering inputs to redraw on input
            $('#displaySize1stPart, #displaySize2ndPart').keyup(function () {
                table.draw();
            });

            $('#ram1stPart, #ram2ndPart').keyup(function () {
                table.draw();
            });

            $('#rom1stPart, #rom2ndPart').keyup(function () {
                table.draw();
            });

            $('#battery1stPart, #battery2ndPart').keyup(function () {
                table.draw();
            });

            $('#price1stPart, #price2ndPart').keyup(function () {
                table.draw();
            });
        });

        //ROM Band Filter
        var RomBandIndex = 0;
        $("#tblSpecs th").each(function (i) {
            //debugger;
            var test = $("#Rom").text().trim();//$($(this)).html();

            if (test == "ROM") {
                
                RomBandIndex = 18; return false;
            }
        });
        //Use the built in datatables API to filter the existing rows by the Category column
        $.fn.dataTable.ext.search.push(
          function (settings, data, dataIndex) {
              var selectedItem = $('#RomBandFilter').val();
              var RomBand = data[RomBandIndex];
              //debugger;
              if (selectedItem === "" || RomBand.includes(selectedItem)) {
                  return true;
              }
              return false;
          }
        );
        $("#RomBandFilter").change(function (e) {
            table.draw();
        });
        table.draw();


        //RAM Band Filter
        var RamBandIndex = 0;
        $("#tblSpecs th").each(function (i) {
            //debugger;
            var test = $("#Ram").text().trim();

            if (test == "RAM") {

                RamBandIndex = 17; return false;
            }
        });

        $.fn.dataTable.ext.search.push(
          function (settings, data, dataIndex) {
              var selectedItem = $('#RamBandFilter').val();
              var RamBand = data[RamBandIndex];
              //debugger;
              if (selectedItem === "" || RamBand.includes(selectedItem)) {
                  return true;
              }
              return false;
          }
        );

        $("#RamBandFilter").change(function (e) {
            table.draw();
        });
        table.draw();


        $('#tblSpecs').on('click', '.btnEdit', function () {
            var row = table.row($(this).parents('tr')).data();
            console.log(row[0]);
            var url = '@Url.Action("Spec","Marketing")' + '/' + row[0];
            window.location.href = url;
        });

        $('#tblSpecs').on('click', '.btnPrice', function () {
            var row = table.row($(this).parents('tr')).data();
            console.log(row[0]);
            var importPrice = $(this).closest('tr').find('td:eq(10)').find('.txtImportPrice').val();
            console.log(importPrice);
            var url = '@Url.Action("CommImportPrice","Marketing")';
            //window.location.href = url;
            $.post(url, { id: row[0], commercialImportPrice: importPrice }, function (data) {
                alertify.success('Saved');
            });
        });
    </script>

